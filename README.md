# ðŸ•ï¸ Snowpeak Game (Co-op Dining)

**Snowpeak Game**ì€ ì‹¤ì œ 'ìŠ¤ë…¸ìš° í”¼í¬ ì¹´íŽ˜ & ë‹¤ì´ë‹' ì•„ë¥´ë°”ì´íŠ¸ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ, Spring Bootì™€ WebSocket, Redisë¥¼ í™œìš©í•´ êµ¬í˜„í•œ **ì‹¤ì‹œê°„ ë©€í‹°í”Œë ˆì´ í˜‘ë™ íƒ€ì´ì¿¤ ê²Œìž„**ìž…ë‹ˆë‹¤.  
í”Œë ˆì´ì–´ë“¤ì€ ê°ê° **í™€(Server)** ê³¼ **ë°”(Barista/Kitchen)** ì—­í• ì„ ë¶„ë‹´í•˜ì—¬, ë°€ë ¤ë“œëŠ” ì†ë‹˜ì„ ë§žì´í•˜ê³  ì£¼ë¬¸ì„ ì²˜ë¦¬í•˜ë©° ë§¤ìž¥ì„ ìš´ì˜í•´ì•¼ í•©ë‹ˆë‹¤.  
ëª¨ë“  ì£¼ë¬¸ ìƒíƒœì™€ í…Œì´ë¸” í˜„í™©ì€ Redisë¥¼ í†µí•´ ì‹¤ì‹œê°„ìœ¼ë¡œ ê³µìœ ë˜ë©°, ë‹¤ìˆ˜ì˜ í”Œë ˆì´ì–´ê°€ ë™ì‹œì— ì£¼ë¬¸ì„ ì²˜ë¦¬í•  ë•Œ ë°œìƒí•  ìˆ˜ ìžˆëŠ” ë™ì‹œì„± ë¬¸ì œëŠ” Lua Scriptë¡œ ì•ˆì „í•˜ê²Œ ì œì–´ë©ë‹ˆë‹¤.

---

## ðŸ“– í”„ë¡œì íŠ¸ ê°œìš”
- **í”„ë¡œì íŠ¸ëª…:** snowpeak_game
- **ì£¼ì œ:** ì‹¤ì‹œê°„ í˜‘ë™ ì¹´íŽ˜ & ë‹¤ì´ë‹ ìš´ì˜ ì‹œë®¬ë ˆì´ì…˜ (Diner Dash ìŠ¤íƒ€ì¼)
- **ëª©í‘œ:**
  - **Producer-Consumer íŒ¨í„´**ì„ ê²Œìž„ ë‚´ ì£¼ë¬¸ ì‹œìŠ¤í…œ(ì£¼ë°©/í™€)ì— ì ìš©
  - ì—¬ëŸ¬ ìœ ì €ê°€ í•˜ë‚˜ì˜ ì£¼ë¬¸ì„ ë™ì‹œì— ì²˜ë¦¬í•˜ë ¤ í•  ë•Œì˜ **Race Condition í•´ê²°**
  - WebSocketì„ í†µí•œ ì‹¤ì‹œê°„ ë§¤ìž¥ ìƒíƒœ(ì£¼ë¬¸ í˜„í™©, í…Œì´ë¸” ìƒíƒœ) ë™ê¸°í™”

---

## ðŸ›  ê¸°ìˆ  ìŠ¤íƒ
### Backend
- **Java 17+**
- **Spring Boot 3.x**
- **Spring WebSocket (STOMP)**
- **Spring Data Redis (Lettuce)**
- **Lua Script** (ì£¼ë¬¸ ì ‘ìˆ˜/ì„œë¹™ ì²˜ë¦¬ì˜ ì›ìžì„± ë³´ìž¥)

### Infra
- **Redis 7.x** (Pub/Sub ë° ìžë£Œêµ¬ì¡° í™œìš©)
- **Docker Compose**

### Client
- **HTML5 / Canvas API** (ë§¤ìž¥ ë§µ ë Œë”ë§)
- **SockJS + STOMP.js**
- **Pixi.js or Phaser** (ì˜µì…˜: ê²Œìž„ UI ë¼ì´ë¸ŒëŸ¬ë¦¬ ê³ ë ¤)

---
## ðŸš€ ì£¼ìš” ê¸°ëŠ¥ & ê²Œìž„ ë£¨í‹´

### 1. ì†ë‹˜ ìž…ìž¥ ë° ìžë¦¬ ë°°ì • (Host)
- ì„œë²„ ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ëžœë¤í•˜ê²Œ ì†ë‹˜ ìƒì„± (WebSocket ì´ë²¤íŠ¸ ë°œì†¡)
- í”Œë ˆì´ì–´(í™€)ê°€ ì†ë‹˜ì„ ë“œëž˜ê·¸í•˜ì—¬ ë¹ˆ í…Œì´ë¸”ì— **ìžë¦¬ ë°°ì •**
- **ê¸°ìˆ ì  í¬ì¸íŠ¸:** ì´ë¯¸ ë°°ì •ëœ í…Œì´ë¸”ì— ì¤‘ë³µ ë°°ì • ë¶ˆê°€í•˜ë„ë¡ Redis `SETNX` í™œìš©

### 2. ì£¼ë¬¸ ì ‘ìˆ˜ ë° ì œì¡° (Kitchen/Bar)
- ì†ë‹˜ì´ ìžë¦¬ì— ì•‰ìœ¼ë©´ ì¼ì • ì‹œê°„ í›„ ì£¼ë¬¸ ë°œìƒ
- **ìŒë£Œ(Cafe):** ë°”ë¦¬ìŠ¤íƒ€ í”Œë ˆì´ì–´ê°€ ë¯¸ë‹ˆê²Œìž„(ê²Œì´ì§€ ë§žì¶”ê¸° ë“±)ì„ í†µí•´ ì œì¡° ì™„ë£Œ
- **ìŒì‹(Dining):** ì¡°ë¦¬ ì‹œê°„ ê²½ê³¼ í›„ 'ì„œë¹™ ê°€ëŠ¥' ìƒíƒœë¡œ ë³€ê²½
- **ê¸°ìˆ ì  í¬ì¸íŠ¸:** ì£¼ë¬¸ ìƒíƒœ(`COOKING` -> `READY`)ë¥¼ Redis Pub/Subìœ¼ë¡œ ëª¨ë“  ì§ì›ì—ê²Œ ì „íŒŒ

### 3. ì„œë¹™ ë° ì •ë¦¬ (Serving)
- **ì„œë¹™:** 'ì¤€ë¹„ ì™„ë£Œ(READY)'ëœ ìŒì‹ì„ í™€ í”Œë ˆì´ì–´ê°€ í”½ì—…í•˜ì—¬ í•´ë‹¹ í…Œì´ë¸”ë¡œ ë°°ë‹¬
- **ì •ë¦¬:** ì‹ì‚¬ê°€ ëë‚œ í…Œì´ë¸”(`DIRTY`)ì„ ì¹˜ì›Œ ë‹¤ì‹œ ì†ë‹˜ì„ ë°›ì„ ìˆ˜ ìžˆëŠ” ìƒíƒœ(`EMPTY`)ë¡œ ì´ˆê¸°í™”
- **ê¸°ìˆ ì  í¬ì¸íŠ¸:** Lua Scriptë¥¼ ì‚¬ìš©í•˜ì—¬ **"í•œ ìŒì‹ì„ ë‘ ëª…ì˜ ì•Œë°”ìƒì´ ë™ì‹œì— ì§‘ëŠ” ë¬¸ì œ"** ì›ì²œ ì°¨ë‹¨

---

## ðŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡°
## ðŸ“ ì•„í‚¤í…ì²˜ (Game Flow)
```mermaid
graph TD
    ClientA[Client A: í™€ ì„œë²„] -->|STOMP| Controller[Spring Boot Controller]
    ClientB[Client B: ë°”ë¦¬ìŠ¤íƒ€] -->|STOMP| Controller
    
    subgraph Spring Boot
    Controller --> OrderService[Order Service]
    Controller --> TableService[Table Service]
    GameLoop[Game Loop Scheduler] -->|ì´ë²¤íŠ¸ ë°œìƒ| Controller
    end
    
    subgraph Redis
    OrderService -->|Push| RedisList[List: ì£¼ë¬¸ ëŒ€ê¸°ì—´]
    TableService -->|Update| RedisHash[Hash: í…Œì´ë¸” ìƒíƒœ]
    RedisScript[Lua Script] -->|Atomic Check| RedisHash
    end
    
    RedisList -.->|Pub/Sub| Broadcast[Broadcast: /topic/store]
    RedisHash -.->|Pub/Sub| Broadcast



